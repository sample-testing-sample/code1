import{r as i,j as t}from"./react-Cq8SGPnk.js";import{a as ze}from"./react-dom-CXUa6nls.js";import{B as Me}from"./react-router-dom--LQ4l7Ey.js";import{I as Ge,n as k,_ as R}from"./react-hot-toast-2qlLGKzS.js";import{l as We}from"./socket.io-client-DjmPdrD_.js";import{L as Ye,R as Je,a as Ve,b as Be,A as $e,c as qe,P as ge,M as we,T as Qe,B as Xe,d as be,e as Ce,I as Ke,G as Ze,f as et,g as tt,h as nt,i as st,j as rt,k as ot,l as it,m as at}from"./react-icons-FtqsRyPL.js";import{v as M}from"./uuid-CQkTLCs1.js";import{F as lt}from"./file-saver-Dn0CgO0O.js";import{J as ct}from"./jszip-iD5t_2rG.js";import{I as ut}from"./vscode-icons-js-DjHKlEgo.js";import{I as Ee}from"./@iconify-BETTlAOr.js";import{c as J}from"./classnames-D3e892sy.js";import{a as dt}from"./axios-B6xwUs71.js";import{l as Ne}from"./lang-map-BDdiMAWE.js";import{a as ft,b as mt,c as ht,d as pt,e as xt,f as gt,g as wt,h as bt,i as Ct,j as Et,k as Nt,l as yt,m as vt,n as jt,o as St,p as Dt,q as It,r as kt,s as Rt,t as Lt,u as Tt,v as Ot,w as Ft,x as At,y as Pt,z as _t,A as Ut,B as Ht,C as zt,D as Mt,E as Gt,F as Wt,G as Yt,H as Jt,I as Vt,J as Bt,K as $t,L as qt,M as Qt,N as Xt,O as Kt,P as Zt,Q as en,R as tn,S as nn,T as sn,U as rn,V as on}from"./@uiw-DB2QHhG5.js";import{A as an}from"./react-avatar-BZdD5jm8.js";import{u as Q,a as ln,b as ye,c as cn,d as de}from"./react-router-DN5oQhh5.js";import{S as un}from"./react-split-CTORCLJp.js";import{T as dn}from"./tldraw-BOKMJKDA.js";import{u as fn}from"./@tldraw-D3J6cX2s.js";import"./lodash.isequal-CoyRWIZe.js";import"./lodash.throttle-DhdlGi_f.js";import"./idb-Bn1DMRyg.js";import"./lodash.uniq-D-VRxY98.js";import"./core-js-Bhaf_3fk.js";import"./lz-string-DjWbGn3S.js";import"./hotkeys-js-BfWqkGRU.js";import{E as mn,bV as hn,bW as pn,bX as xn}from"./@codemirror-CDLaMFvO.js";import{s as fe}from"./screenfull-DmVOzVZz.js";import"./charenc-CKB3dhLb.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-DaH1AUis.js";import"./goober-vt3s6TGe.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./@babel-CihsqhTw.js";import"./@lezer-Y4zGP-Qs.js";import"./codemirror-lang-mermaid-D9zABNwx.js";import"./@replit-BfWWMKLx.js";import"./@nextjournal-CZom88Vv.js";import"./colors-named-CSGyx1iI.js";import"./colors-named-hex-Db6HdBCI.js";import"./hsl-matcher-CyxH9sTP.js";import"./core-js-pure-D91HoSut.js";import"./prop-types-BpeVGpEB.js";import"./is-retina-ZyRGC3SP.js";import"./md5-DIQITYX7.js";import"./crypt-cVg_o3mt.js";import"./is-buffer-DoLxFxiE.js";import"./split.js-CPyVEc61.js";import"./@radix-ui-wlNBanPt.js";import"./react-remove-scroll-BL8kK4eu.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-CngPHc6C.js";import"./react-style-singleton-Dh4d9j2o.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-DVfAVLcY.js";import"./use-callback-ref-Ja3Cr9ZF.js";import"./aria-hidden-DQ5UC2Eg.js";import"./@floating-ui-BqvF5u-u.js";import"./canvas-size-CezOLxoY.js";import"./@use-gesture-BNQCFn2f.js";import"./eventemitter3-6E4L_h32.js";import"./crelt-C8TCjufn.js";import"./style-mod-gVpFNjS1.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();function ve(){return{setItem:(r,o)=>{localStorage.setItem(r,o)},getItem:r=>localStorage.getItem(r),removeItem:r=>{localStorage.removeItem(r)}}}const je=i.createContext(null),q=()=>{const e=i.useContext(je);if(!e)throw new Error("useSettings must be used within a SettingContextProvider");return e},P={theme:"Dracula",language:"Javascript",fontSize:16,fontFamily:"Space Mono",showGitHubCorner:!0};function gn({children:e}){const{getItem:n}=ve(),s=JSON.parse(n("settings")||"{}"),r=s.theme!==void 0?s.theme:P.theme,o=s.language!==void 0?s.language:P.language,a=s.fontSize!==void 0?s.fontSize:P.fontSize,d=s.fontFamily!==void 0?s.fontFamily:P.fontFamily,u=s.showGitHubCorner!==void 0?s.showGitHubCorner:P.showGitHubCorner,[l,c]=i.useState(r),[m,v]=i.useState(o),[C,h]=i.useState(a),[g,y]=i.useState(d),[S,j]=i.useState(u),A=()=>{c(P.theme),v(P.language),h(P.fontSize),y(P.fontFamily),j(P.showGitHubCorner)};return i.useEffect(()=>{const O={theme:l,language:m,fontSize:C,fontFamily:g,showGitHubCorner:S};localStorage.setItem("settings",JSON.stringify(O))},[l,m,C,g,S]),t.jsx(je.Provider,{value:{theme:l,setTheme:c,language:m,setLanguage:v,fontSize:C,setFontSize:h,fontFamily:g,setFontFamily:y,showGitHubCorner:S,setShowGitHubCorner:j,resetSettings:A},children:e})}function G(){const[e,n]=i.useState({width:window.innerWidth,height:window.innerHeight}),[s,r]=i.useState(window.innerWidth<768);return i.useEffect(()=>{const o=()=>{n({width:window.innerWidth,height:window.innerHeight}),r(window.innerWidth<768)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),{...e,isMobile:s}}function wn(){const{showGitHubCorner:e}=q(),{width:n}=G();return t.jsx("a",{href:"https://docs.google.com/document/d/1aRbM5q3E14JCdtn6Ao6zrAW-7rFiNCAQ/edit?usp=drive_link&ouid=100964786605067152952&rtpof=true&sd=true",className:"github-corner","aria-label":"View source on GitHub",target:"_blank",rel:"noreferrer",style:{display:e&&n>640?"block":"none"},children:t.jsx("svg",{width:"150",height:"100",viewBox:"0 0 250 250",className:"absolute right-0 top-0 z-10 border-none bg-primary text-gray-900 dark:text-gray-100","aria-hidden":"true",style:{color:"#151513",transform:"rotate(45deg) translate(12%,-80%) scale(0.8)"},children:t.jsxs("g",{style:{transform:"rotate(-45deg) translate(0%,50%)",transformOrigin:"bottom"},children:[t.jsx("rect",{x:"30",y:"10",width:"100",height:"140",rx:"8",ry:"8",fill:"currentColor"}),t.jsx("line",{x1:"30",y1:"40",x2:"130",y2:"40",stroke:"#ffffff",strokeWidth:"2"}),t.jsx("line",{x1:"30",y1:"60",x2:"130",y2:"60",stroke:"#ffffff",strokeWidth:"2"}),t.jsx("line",{x1:"30",y1:"80",x2:"130",y2:"80",stroke:"#ffffff",strokeWidth:"2"}),t.jsx("line",{x1:"30",y1:"100",x2:"130",y2:"100",stroke:"#ffffff",strokeWidth:"2"}),t.jsx("line",{x1:"30",y1:"120",x2:"130",y2:"120",stroke:"#ffffff",strokeWidth:"2"}),t.jsx("path",{d:"M115,10 C115,5 120,5 120,10 L120,150 C120,155 115,155 115,150 Z",fill:"#ffffff"})]})})})}function bn(){return t.jsx(Ge,{position:"top-right"})}var U=(e=>(e.CODING="coding",e.DRAWING="drawing",e))(U||{}),$=(e=>(e.OFFLINE="offline",e.ONLINE="online",e))($||{}),T=(e=>(e.INITIAL="initial",e.CONNECTING="connecting",e.ATTEMPTING_JOIN="attempting-join",e.JOINED="joined",e.CONNECTION_FAILED="connection-failed",e.DISCONNECTED="disconnected",e))(T||{});const Se=i.createContext(null),L=()=>{const e=i.useContext(Se);if(e===null)throw new Error("useAppContext must be used within a AppContextProvider");return e};function Cn({children:e}){const[n,s]=i.useState([]),[r,o]=i.useState(T.INITIAL),[a,d]=i.useState({username:"",roomId:""}),[u,l]=i.useState(U.CODING),[c,m]=i.useState(null);return t.jsx(Se.Provider,{value:{users:n,setUsers:s,currentUser:a,setCurrentUser:d,status:r,setStatus:o,activityState:u,setActivityState:l,drawingData:c,setDrawingData:m},children:e})}var x=(e=>(e.JOIN_REQUEST="join-request",e.JOIN_ACCEPTED="join-accepted",e.USER_JOINED="user-joined",e.USER_DISCONNECTED="user-disconnected",e.SYNC_FILE_STRUCTURE="sync-file-structure",e.DIRECTORY_CREATED="directory-created",e.DIRECTORY_UPDATED="directory-updated",e.DIRECTORY_RENAMED="directory-renamed",e.DIRECTORY_DELETED="directory-deleted",e.FILE_CREATED="file-created",e.FILE_UPDATED="file-updated",e.FILE_RENAMED="file-renamed",e.FILE_DELETED="file-deleted",e.USER_OFFLINE="offline",e.USER_ONLINE="online",e.SEND_MESSAGE="send-message",e.RECEIVE_MESSAGE="receive-message",e.TYPING_START="typing-start",e.TYPING_PAUSE="typing-pause",e.USERNAME_EXISTS="username-exists",e.REQUEST_DRAWING="request-drawing",e.SYNC_DRAWING="sync-drawing",e.DRAWING_UPDATE="drawing-update",e))(x||{});const De=i.createContext(null),_=()=>{const e=i.useContext(De);if(!e)throw new Error("useSocket must be used within a SocketProvider");return e},En="http://localhost:3000",Nn=({children:e})=>{const{users:n,setUsers:s,setStatus:r,setCurrentUser:o,drawingData:a,setDrawingData:d}=L(),u=i.useMemo(()=>We(En,{reconnectionAttempts:2}),[]),l=i.useCallback(g=>{console.log("socket error",g),r(T.CONNECTION_FAILED),k.dismiss(),k.error("Failed to connect to the server")},[r]),c=i.useCallback(()=>{k.dismiss(),r(T.INITIAL),k.error("The username you chose already exists in the room. Please choose a different username.")},[r]),m=i.useCallback(({user:g,users:y})=>{o(g),s(y),k.dismiss(),r(T.JOINED),y.length>1&&k.loading("Syncing data, please wait...")},[o,r,s]),v=i.useCallback(({user:g})=>{k.success(`${g.username} left the room`),s(n.filter(y=>y.username!==g.username))},[s,n]),C=i.useCallback(({socketId:g})=>{u.emit(x.SYNC_DRAWING,{socketId:g,drawingData:a})},[a,u]),h=i.useCallback(({drawingData:g})=>{d(g)},[d]);return i.useEffect(()=>(u.on("connect_error",l),u.on("connect_failed",l),u.on(x.USERNAME_EXISTS,c),u.on(x.JOIN_ACCEPTED,m),u.on(x.USER_DISCONNECTED,v),u.on(x.REQUEST_DRAWING,C),u.on(x.SYNC_DRAWING,h),()=>{u.off("connect_error"),u.off("connect_failed"),u.off(x.USERNAME_EXISTS),u.off(x.JOIN_ACCEPTED),u.off(x.USER_DISCONNECTED),u.off(x.REQUEST_DRAWING),u.off(x.SYNC_DRAWING)}),[h,l,m,C,v,c,s,u]),t.jsx(De.Provider,{value:{socket:u},children:e})},Ie=i.createContext(null),ee=()=>{const e=i.useContext(Ie);if(!e)throw new Error("useChatRoom must be used within a ChatContextProvider");return e};function yn({children:e}){const{socket:n}=_(),[s,r]=i.useState([]),[o,a]=i.useState(!1),[d,u]=i.useState(0);return i.useEffect(()=>(n.on(x.RECEIVE_MESSAGE,({message:l})=>{r(c=>[...c,l]),a(!0)}),()=>{n.off(x.RECEIVE_MESSAGE)}),[n]),t.jsx(Ie.Provider,{value:{messages:s,setMessages:r,isNewMessage:o,setIsNewMessage:a,lastScrollHeight:d,setLastScrollHeight:u},children:e})}function vn(e){const n=new Date(e);let s=n.getHours();const r=String(n.getMinutes()).padStart(2,"0"),o=s>=12?"PM":"AM";return s=s%12,s=s||12,`${s}:${r} ${o}`}function jn(){const{currentUser:e}=L(),{socket:n}=_(),{setMessages:s}=ee(),r=i.useRef(null),o=a=>{var u;a.preventDefault();const d=(u=r.current)==null?void 0:u.value.trim();if(d&&d.length>0){const l={id:M(),message:d,username:e.username,timestamp:vn(new Date().toISOString())};n.emit(x.SEND_MESSAGE,{message:l}),s(c=>[...c,l]),r.current&&(r.current.value="")}};return t.jsxs("form",{onSubmit:o,className:"flex justify-between rounded-md border border-primary",children:[t.jsx("input",{type:"text",className:"w-full flex-grow rounded-md border-none bg-dark p-2 outline-none",placeholder:"Enter a message...",ref:r}),t.jsx("button",{className:"flex items-center justify-center rounded-r-md  bg-primary p-2 text-black",type:"submit",children:t.jsx(Ye,{size:24})})]})}function Sn(){const{messages:e,isNewMessage:n,setIsNewMessage:s,lastScrollHeight:r,setLastScrollHeight:o}=ee(),{currentUser:a}=L(),d=i.useRef(null),u=l=>{const c=l.target;o(c.scrollTop)};return i.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[e]),i.useEffect(()=>{n&&s(!1),d.current&&(d.current.scrollTop=r)},[n,s,r]),t.jsx("div",{className:"flex-grow overflow-auto rounded-md bg-darkHover p-2",ref:d,onScroll:u,children:e.map((l,c)=>t.jsxs("div",{className:"mb-2 w-[80%] self-end break-words rounded-md bg-dark px-3 py-2"+(l.username===a.username?" ml-auto ":""),children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-xs text-primary",children:l.username}),t.jsx("span",{className:"text-xs text-white",children:l.timestamp})]}),t.jsx("p",{className:"py-1",children:l.message})]},c))})}function F(){const[e,n]=i.useState(!1),{height:s,isMobile:r}=G(),[o,a]=i.useState(s);return i.useEffect(()=>{s<500&&r?(n(!0),a(s)):r?(n(!1),a(s-50)):(n(!1),a(s))},[s,r,o]),{viewHeight:o,minHeightReached:e}}const Dn=()=>{const{viewHeight:e}=F();return t.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:e},children:[t.jsx("h1",{className:"view-title",children:"Group Chat"}),t.jsx(Sn,{}),t.jsx(jn,{})]})},In=`function sayHi() {
  console.log("👋 Hello world");
}

sayHi()`,kn={name:"root",id:M(),type:"directory",children:[{id:M(),type:"file",name:"index.js",content:In}]},ke=(e,n)=>{if(e.id===n&&e.type==="directory")return e;if(e.type==="directory"&&e.children)for(const s of e.children){const r=ke(s,n);if(r)return r}return null},me=(e,n)=>e.children?e.children.some(s=>s.name===n):!1,Rn=(e,n)=>{const s=r=>{if(r.id===n)return r;if(r.children)for(const o of r.children){const a=s(o);if(a)return a}return null};return s(e)},Re=e=>{if(e.type==="directory"&&e.children){let n=e.children.filter(r=>r.type==="directory");const s=e.children.filter(r=>r.type==="file");n.sort((r,o)=>r.name.localeCompare(o.name)),n=n.map(r=>Re(r)),s.sort((r,o)=>r.name.localeCompare(o.name)),e.children=[...n.filter(r=>r.name.startsWith(".")),...n.filter(r=>!r.name.startsWith(".")),...s.filter(r=>r.name.startsWith(".")),...s.filter(r=>!r.name.startsWith("."))]}return e},Le=i.createContext(null),H=()=>{const e=i.useContext(Le);if(!e)throw new Error("useFileSystem must be used within FileContextProvider");return e};function Ln({children:e}){const{socket:n}=_(),{setUsers:s,drawingData:r}=L(),[o,a]=i.useState(kn),d=o.children?o.children:[],[u,l]=i.useState(d),[c,m]=i.useState(u[0]),v=f=>{const p=b=>b.id===f?{...b,isOpen:!b.isOpen}:b.children?{...b,children:b.children.map(p)}:b;a(b=>p(b))},C=()=>{const f=p=>{var b;return{...p,isOpen:!1,children:(b=p.children)==null?void 0:b.map(f)}};a(p=>f(p))},h=i.useCallback((f,p,b=!0)=>{let w;typeof p=="string"?w={id:M(),name:p,type:"directory",children:[],isOpen:!1}:w=p,f||(f=o.id);const E=N=>N.id===f?{...N,children:[...N.children||[],w]}:N.children?{...N,children:N.children.map(E)}:N;return a(N=>E(N)),b&&n.emit(x.DIRECTORY_CREATED,{parentDirId:f,newDirectory:w}),w.id},[o.id,n]),g=i.useCallback((f,p,b=!0)=>{f||(f=o.id);const w=E=>E.id===f?{...E,children:p}:E.children?{...E,children:E.children.map(w)}:E;a(E=>w(E)),l([]),m(null),f===o.id&&(k.dismiss(),k.success("Files and folders updated")),b&&n.emit(x.DIRECTORY_UPDATED,{dirId:f,children:p})},[o.id,n]),y=i.useCallback((f,p,b=!0)=>{const w=N=>N.type==="directory"&&N.children?N.children.some(D=>D.type==="directory"&&D.name===p&&D.id!==f)?null:{...N,children:N.children.map(D=>{if(D.id===f)return{...D,name:p};if(D.type==="directory"){const V=w(D);return V!==null?V:D}else return D})}:N,E=w(o);return E===null?!1:(a(E),b&&n.emit(x.DIRECTORY_RENAMED,{dirId:f,newDirName:p}),!0)},[n,a,o]),S=i.useCallback((f,p=!0)=>{const b=w=>{if(w.type==="directory"&&w.id===f)return null;if(w.children){const E=w.children.map(b).filter(N=>N!==null);return{...w,children:E}}else return w};a(w=>b(w)),p&&n.emit(x.DIRECTORY_DELETED,{dirId:f})},[n]),j=f=>{const p=Rn(o,f);p&&(z((c==null?void 0:c.id)||"",(c==null?void 0:c.content)||""),u.some(b=>b.id===f)||l(b=>[...b,p]),l(b=>b.map(w=>w.id===(c==null?void 0:c.id)?{...w,content:c.content||""}:w)),m(p))},A=f=>{if(f===(c==null?void 0:c.id)){z(c.id,c.content||"");const p=u.findIndex(b=>b.id===f);p!==-1&&u.length>1?p>0?m(u[p-1]):m(u[p+1]):m(null)}l(p=>p.filter(b=>b.id!==f))},O=i.useCallback((f,p,b=!0)=>{let w=1;f||(f=o.id);const E=ke(o,f);if(!E)throw new Error("Parent directory not found");let N;if(typeof p=="string"){let D=p,V=me(E,D);for(;V;)D=`${D.split(".")[0]}(${w}).${D.split(".")[1]}`,V=me(E,D),w++;N={id:M(),name:D,type:"file",content:""}}else N=p;const K=D=>D.id===E.id?{...D,children:[...D.children||[],N],isOpen:!0}:D.children?{...D,children:D.children.map(K)}:D;return a(D=>K(D)),l(D=>[...D,N]),m(N),b&&n.emit(x.FILE_CREATED,{parentDirId:f,newFile:N}),N.id},[o,n]),z=i.useCallback((f,p)=>{const b=w=>w.type==="file"&&w.id===f?{...w,content:p}:w.children?{...w,children:w.children.map(b)}:w;a(w=>b(w)),u.some(w=>w.id===f)&&l(w=>w.map(E=>E.id===f?{...E,content:p}:E))},[u]),W=i.useCallback((f,p,b=!0)=>{const w=E=>E.type==="directory"&&E.children?{...E,children:E.children.map(N=>N.type==="file"&&N.id===f?{...N,name:p}:N)}:E;return a(E=>w(E)),l(E=>E.map(N=>N.id===f?{...N,name:p}:N)),f===(c==null?void 0:c.id)&&m(E=>E?{...E,name:p}:null),b&&n.emit(x.FILE_RENAMED,{fileId:f,newName:p}),!0},[c==null?void 0:c.id,n]),Y=i.useCallback((f,p=!0)=>{const b=w=>{if(w.type==="directory"&&w.children){const E=w.children.map(N=>N.type==="directory"?b(N):N.id!==f?N:null).filter(N=>N!==null);return{...w,children:E}}else return w};a(w=>b(w)),u.some(w=>w.id===f)&&l(w=>w.filter(E=>E.id!==f)),(c==null?void 0:c.id)===f&&m(null),k.success("File deleted successfully"),p&&n.emit(x.FILE_DELETED,{fileId:f})},[c==null?void 0:c.id,u,n]),He=()=>{const f=new ct,p=(b,w="")=>{const E=w+b.name+(b.type==="directory"?"/":"");if(b.type==="file")f.file(E,b.content||"");else if(b.type==="directory"&&b.children)for(const N of b.children)p(N,E)};if(o.type==="directory"&&o.children)for(const b of o.children)p(b);f.generateAsync({type:"blob"}).then(b=>{lt.saveAs(b,"download.zip")})},te=i.useCallback(({user:f})=>{k.success(`${f.username} joined the room`),n.emit(x.SYNC_FILE_STRUCTURE,{fileStructure:o,openFiles:u,activeFile:c,socketId:f.socketId}),n.emit(x.SYNC_DRAWING,{drawingData:r,socketId:f.socketId}),s(p=>[...p,f])},[c,r,o,u,s,n]),ne=i.useCallback(({fileStructure:f,openFiles:p,activeFile:b})=>{a(f),l(p),m(b),k.dismiss()},[]),se=i.useCallback(({parentDirId:f,newDirectory:p})=>{h(f,p,!1)},[h]),re=i.useCallback(({dirId:f,children:p})=>{g(f,p,!1)},[g]),oe=i.useCallback(({dirId:f,newName:p})=>{y(f,p,!1)},[y]),ie=i.useCallback(({dirId:f})=>{S(f,!1)},[S]),ae=i.useCallback(({parentDirId:f,newFile:p})=>{O(f,p,!1)},[O]),le=i.useCallback(({fileId:f,newContent:p})=>{z(f,p),(c==null?void 0:c.id)===f&&m({...c,content:p})},[c,z]),ce=i.useCallback(({fileId:f,newName:p})=>{W(f,p,!1)},[W]),ue=i.useCallback(({fileId:f})=>{Y(f,!1)},[Y]);return i.useEffect(()=>(n.once(x.SYNC_FILE_STRUCTURE,ne),n.on(x.USER_JOINED,te),n.on(x.DIRECTORY_CREATED,se),n.on(x.DIRECTORY_UPDATED,re),n.on(x.DIRECTORY_RENAMED,oe),n.on(x.DIRECTORY_DELETED,ie),n.on(x.FILE_CREATED,ae),n.on(x.FILE_UPDATED,le),n.on(x.FILE_RENAMED,ce),n.on(x.FILE_DELETED,ue),()=>{n.off(x.USER_JOINED),n.off(x.DIRECTORY_CREATED),n.off(x.DIRECTORY_UPDATED),n.off(x.DIRECTORY_RENAMED),n.off(x.DIRECTORY_DELETED),n.off(x.FILE_CREATED),n.off(x.FILE_UPDATED),n.off(x.FILE_RENAMED),n.off(x.FILE_DELETED)}),[se,ie,oe,re,ae,ue,ce,ne,le,te,n]),t.jsx(Le.Provider,{value:{fileStructure:o,openFiles:u,activeFile:c,setActiveFile:m,closeFile:A,toggleDirectory:v,collapseDirectories:C,createDirectory:h,updateDirectory:g,renameDirectory:y,deleteDirectory:S,openFile:j,createFile:O,updateFileContent:z,renameFile:W,deleteFile:Y,downloadFilesAndFolders:He},children:e})}const Te=({ref:e})=>{const[n,s]=i.useState(!1),[r,o]=i.useState({x:0,y:0});return i.useEffect(()=>{const a=e.current;if(!a)return;const d=()=>{s(!1)},u=c=>{e.current&&e.current.contains(c.target)?(s(!0),o({x:c.pageX,y:c.pageY})):s(!1)},l=c=>{c.preventDefault(),s(!0),o({x:c.pageX,y:c.pageY})};return a.addEventListener("contextmenu",l),document.addEventListener("click",d),document.addEventListener("contextmenu",u),()=>{a.removeEventListener("contextmenu",l),document.removeEventListener("click",d),document.removeEventListener("contextmenu",u)}},[e]),{menuOpen:n,setMenuOpen:s,coords:r,setCoords:o}},Oe=e=>{var r;return`vscode-icons:${(r=ut.getIconForFile(e))==null?void 0:r.replace(/_/g,"-").split(".")[0]}`};function Fe({id:e,preName:n,setEditing:s,type:r}){const[o,a]=i.useState(n||""),{renameFile:d,openFile:u,renameDirectory:l}=H(),c=i.useRef(null),m=h=>{h.preventDefault(),h.stopPropagation();const g=r.charAt(0).toUpperCase()+r.slice(1);if(o==="")R.error(`${g} name cannot be empty`);else if(o.length>25)R.error(`${g} name cannot be longer than 25 characters`);else if(o===n)R.error(`${g} name cannot be the same as before`);else{const y=r==="directory"?l(e,o):d(e,o);y&&r==="file"&&u(e),y?s(!1):R.error(`${g} with same name already exists`)}},v=i.useCallback(h=>{var g;h.key==="Enter"?(g=c.current)==null||g.requestSubmit():h.key==="Escape"&&s(!1)},[s]),C=i.useCallback(h=>{const g=c.current;g&&!g.contains(h.target)&&s(!1)},[s]);return i.useEffect(()=>{const h=c.current;if(h)return h.focus(),h.addEventListener("keydown",v),document.addEventListener("keydown",C),document.addEventListener("click",C),()=>{h.removeEventListener("keydown",v),document.removeEventListener("keydown",C),document.removeEventListener("click",C)}},[C,v,s]),t.jsx("div",{className:"rounded-md",children:t.jsx("form",{onSubmit:m,ref:c,className:"flex w-full items-center gap-2 rounded-md",children:t.jsx("input",{type:"text",className:"w-full flex-grow rounded-sm bg-dark px-2 text-base text-white outline-none",autoFocus:!0,value:o,onChange:h=>a(h.target.value)})})})}function Tn(){const{fileStructure:e,createFile:n,createDirectory:s,collapseDirectories:r}=H(),o=i.useRef(null),[a,d]=i.useState(null),{minHeightReached:u}=F(),l=C=>{o.current&&!o.current.contains(C.target)&&d(e.id)},c=()=>{const C=prompt("Enter file name");if(C){const h=a||e.id;n(h,C)}},m=()=>{const C=prompt("Enter directory name");if(C){const h=a||e.id;s(h,C)}},v=Re(e);return t.jsxs("div",{onClick:l,className:"flex flex-grow flex-col",children:[t.jsxs("div",{className:"view-title flex justify-between",children:[t.jsx("h2",{children:"Files"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:c,title:"Create File",children:t.jsx(Je,{size:20})}),t.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:m,title:"Create Directory",children:t.jsx(Ve,{size:20})}),t.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:r,title:"Collapse All Directories",children:t.jsx(Be,{size:20})})]})]}),t.jsx("div",{className:J("min-h-[200px] flex-grow overflow-auto pr-2 sm:min-h-0",{"h-[calc(80vh-170px)]":!u,"h-[85vh]":u}),ref:o,children:v.children&&v.children.map(C=>t.jsx(Ae,{item:C,setSelectedDirId:d},C.id))})]})}function Ae({item:e,setSelectedDirId:n}){const[s,r]=i.useState(!1),o=i.useRef(null),{coords:a,menuOpen:d,setMenuOpen:u}=Te({ref:o}),{deleteDirectory:l,toggleDirectory:c}=H(),m=h=>{n(h),c(h)},v=h=>{h.stopPropagation(),u(!1),r(!0)},C=(h,g)=>{h.stopPropagation(),u(!1),confirm("Are you sure you want to delete directory?")&&l(g)};return i.useEffect(()=>{const h=o.current;if(!h)return;h.tabIndex=0;const g=y=>{y.stopPropagation(),y.key==="F2"&&r(!0)};return h.addEventListener("keydown",g),()=>{h.removeEventListener("keydown",g)}},[]),e.type==="file"?t.jsx(On,{item:e,setSelectedDirId:n}):t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>m(e.id),ref:o,children:[e.isOpen?t.jsx($e,{size:24,className:"mr-2 min-w-fit"}):t.jsx(qe,{size:24,className:"mr-2 min-w-fit"}),s?t.jsx(Fe,{id:e.id,preName:e.name,type:"directory",setEditing:r}):t.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:e.name,children:e.name})]}),t.jsx("div",{className:J({hidden:!e.isOpen},{block:e.isOpen},{"pl-4":e.name!=="root"}),children:e.children&&e.children.map(h=>t.jsx(Ae,{item:h,setSelectedDirId:n},h.id))}),d&&t.jsx(An,{handleDeleteDirectory:C,handleRenameDirectory:v,id:e.id,left:a.x,top:a.y})]})}const On=({item:e,setSelectedDirId:n})=>{const{deleteFile:s,openFile:r}=H(),[o,a]=i.useState(!1),{setIsSidebarOpen:d}=X(),{isMobile:u}=G(),{activityState:l,setActivityState:c}=L(),m=i.useRef(null),{menuOpen:v,coords:C,setMenuOpen:h}=Te({ref:m}),g=j=>{o||(n(j),r(j),u&&d(!1),l===U.DRAWING&&c(U.CODING))},y=j=>{j.stopPropagation(),a(!0),h(!1)},S=(j,A)=>{j.stopPropagation(),h(!1),confirm("Are you sure you want to delete file?")&&s(A)};return i.useEffect(()=>{const j=m.current;if(!j)return;j.tabIndex=0;const A=O=>{O.stopPropagation(),O.key==="F2"&&a(!0)};return j.addEventListener("keydown",A),()=>{j.removeEventListener("keydown",A)}},[]),t.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>g(e.id),ref:m,children:[t.jsx(Ee,{icon:Oe(e.name),fontSize:22,className:"mr-2 min-w-fit"}),o?t.jsx(Fe,{id:e.id,preName:e.name,type:"file",setEditing:a}):t.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:e.name,children:e.name}),v&&t.jsx(Fn,{top:C.y,left:C.x,id:e.id,handleRenameFile:y,handleDeleteFile:S})]})},Fn=({top:e,left:n,id:s,handleRenameFile:r,handleDeleteFile:o})=>t.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:e,left:n},children:[t.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[t.jsx(ge,{size:18}),"Rename"]}),t.jsxs("button",{onClick:a=>o(a,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[t.jsx(we,{size:20}),"Delete"]})]}),An=({top:e,left:n,id:s,handleRenameDirectory:r,handleDeleteDirectory:o})=>t.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:e,left:n},children:[t.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[t.jsx(ge,{size:18}),"Rename"]}),t.jsxs("button",{onClick:a=>o(a,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[t.jsx(we,{size:20}),"Delete"]})]});function Pn(){const{downloadFilesAndFolders:e,updateDirectory:n}=H(),{viewHeight:s}=F(),{minHeightReached:r}=F(),o=async()=>{if("showDirectoryPicker"in window)try{const d=await window.showDirectoryPicker();k.loading("Getting files and folders...");const u=await a(d);n("",u)}catch(d){console.error("Error opening directory:",d)}else alert("The File System Access API is not supported in this browser.")},a=async d=>{const u=[],l=["node_modules",".git",".vscode",".next"];for await(const c of d.values())if(c.kind==="file"){const m=await c.getFile(),v={id:M(),name:c.name,type:"file",content:await m.text()};u.push(v)}else if(c.kind==="directory"){if(l.includes(c.name))continue;const m={id:M(),name:c.name,type:"directory",children:await a(c),isOpen:!1};u.push(m)}return u};return t.jsxs("div",{className:"flex select-none flex-col gap-1 px-4 py-2",style:{height:s,maxHeight:s},children:[t.jsx(Tn,{}),t.jsxs("div",{className:J("flex min-h-fit flex-col justify-end pt-2",{hidden:r}),children:[t.jsx("hr",{}),t.jsxs("button",{className:"mt-2 flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:o,children:[t.jsx(Qe,{className:"mr-2",size:24}),"Open File/Folder"]}),t.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:e,children:[t.jsx(Xe,{className:"mr-2",size:22})," Download Code"]})]})]})}const _n="https://emkc.org/api/v2/piston",he=dt.create({baseURL:_n,headers:{"Content-Type":"application/json"}}),Pe=i.createContext(null),Un=()=>{const e=i.useContext(Pe);if(e===null)throw new Error("useRunCode must be used within a RunCodeContextProvider");return e},Hn=({children:e})=>{const{activeFile:n}=H(),[s,r]=i.useState(""),[o,a]=i.useState(""),[d,u]=i.useState(!1),[l,c]=i.useState([]),[m,v]=i.useState({language:"",version:"",aliases:[]});i.useEffect(()=>{(async()=>{var g,y;try{const S=await he.get("/runtimes");c(S.data)}catch(S){R.error("Failed to fetch supported languages"),(g=S==null?void 0:S.response)!=null&&g.data&&console.error((y=S==null?void 0:S.response)==null?void 0:y.data)}})()},[]),i.useEffect(()=>{if(l.length===0||!(n!=null&&n.name))return;const h=n.name.split(".").pop();if(h){const g=Ne.languages(h),y=l.find(S=>S.aliases.includes(h)||g.includes(S.language.toLowerCase()));y&&v(y)}else v({language:"",version:"",aliases:[]})},[n==null?void 0:n.name,l]);const C=async()=>{try{if(m)if(n)R.loading("Running code...");else return R.error("Please open a file to run the code");else return R.error("Please select a language to run the code");u(!0);const{language:h,version:g}=m,y=await he.post("/execute",{language:h,version:g,files:[{name:n.name,content:n.content}],stdin:s});y.data.run.stderr?a(y.data.run.stderr):a(y.data.run.stdout),u(!1),R.dismiss()}catch(h){console.error(h.response.data),console.error(h.response.data.error),u(!1),R.dismiss(),R.error("Failed to run the code")}};return t.jsx(Pe.Provider,{value:{setInput:r,output:o,isRunning:d,supportedLanguages:l,selectedLanguage:m,setSelectedLanguage:v,runCode:C},children:e})};function zn(){const{viewHeight:e}=F(),{setInput:n,output:s,isRunning:r,supportedLanguages:o,selectedLanguage:a,setSelectedLanguage:d,runCode:u}=Un(),l=m=>{const v=JSON.parse(m.target.value);d(v)},c=()=>{navigator.clipboard.writeText(s),R.success("Output copied to clipboard")};return t.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:e},children:[t.jsx("h1",{className:"view-title",children:"Run Code"}),t.jsxs("div",{className:"flex h-[90%] w-full flex-col items-end gap-2 md:h-[92%]",children:[t.jsxs("div",{className:"relative w-full",children:[t.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:JSON.stringify(a),onChange:l,children:o.sort((m,v)=>m.language>v.language?1:-1).map((m,v)=>t.jsx("option",{value:JSON.stringify(m),children:m.language+(m.version?` (${m.version})`:"")},v))}),t.jsx(be,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]}),t.jsx("textarea",{className:"min-h-[120px] w-full resize-none rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"Write you input here...",onChange:m=>n(m.target.value)}),t.jsx("button",{className:"flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:u,disabled:r,children:"Run"}),t.jsxs("label",{className:"flex w-full justify-between",children:["Output :",t.jsx("button",{onClick:c,title:"Copy Output",children:t.jsx(Ce,{size:18,className:"cursor-pointer text-white"})})]}),t.jsx("div",{className:"w-full flex-grow resize-none overflow-y-auto rounded-md border-none bg-darkHover p-2 text-white outline-none",children:t.jsx("code",{children:t.jsx("pre",{className:"text-wrap",children:s})})})]})]})}function Z({onChange:e,value:n,options:s,title:r}){return t.jsxs("div",{className:"relative w-full",children:[t.jsx("label",{className:"mb-2",children:r}),t.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:n,onChange:e,children:s.sort().map(o=>{const a=o,d=o.charAt(0).toUpperCase()+o.slice(1);return t.jsx("option",{value:a,children:d},d)})}),t.jsx(be,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]})}const Mn=["Anonymous Pro","Cousine","Fira Code","Inconsolata","JetBrains Mono","Jura","Roboto Mono","Source Code Pro","Space Mono","Ubuntu Mono"],_e={Abcdef:ft,Abyss:mt,"Android Studio":ht,Andromeda:pt,"Atom One":xt,Aura:gt,"Basic Dark":wt,"Basic Light":bt,BBEdit:Ct,Bespin:Et,Copilot:Nt,Darcula:yt,Dracula:vt,"Duotone Dark":jt,"Duotone Light":St,Eclipse:Dt,"GitHub Dark":It,"GitHub Light":kt,"Gruvbox Dark":Rt,"Gruvbox Light":Lt,Kimbie:Tt,Material:Ot,"Material Dark":Ft,"Material Light":At,Monokai:Pt,"Monokai Dimmed":_t,"Noctis Lilac":Ut,Nord:Ht,Okaidia:zt,"Quiet Light":Mt,Red:Gt,"Solarized Dark":Wt,"Solarized Light":Yt,Sublime:Jt,"Tokyo Night":Vt,"Tokyo Night Day":Bt,"Tokyo Night Storm":$t,"Tomorrow Night Blue":qt,"VS Code Dark":Qt,"White Dark":Xt,"White Light":Kt,"Xcode Dark":Zt,"Xcode Light":en};function Gn(){const{theme:e,setTheme:n,language:s,setLanguage:r,fontSize:o,setFontSize:a,fontFamily:d,setFontFamily:u,showGitHubCorner:l,setShowGitHubCorner:c,resetSettings:m}=q(),{viewHeight:v}=F(),C=j=>u(j.target.value),h=j=>n(j.target.value),g=j=>r(j.target.value),y=j=>a(parseInt(j.target.value)),S=j=>c(j.target.checked);return i.useEffect(()=>{const j=document.querySelector(".cm-editor > .cm-scroller");j!==null&&(j.style.fontFamily=`${d}, monospace`)},[d]),t.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:v},children:[t.jsx("h1",{className:"view-title",children:"Settings"}),t.jsxs("div",{className:"flex w-full items-end gap-2",children:[t.jsx(Z,{onChange:C,value:d,options:Mn,title:"Font Family"}),t.jsx("select",{value:o,onChange:y,className:"rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",title:"Font Size",children:[...Array(13).keys()].map(j=>t.jsx("option",{value:j+12,children:j+12},j))})]}),t.jsx(Z,{onChange:h,value:e,options:Object.keys(_e),title:"Theme"}),t.jsx(Z,{onChange:g,value:s,options:tn,title:"Language"}),t.jsxs("div",{className:"mt-4 flex w-full items-center justify-between",children:[t.jsx("label",{children:"Show report corner"}),t.jsxs("label",{className:"relative inline-flex cursor-pointer items-center",children:[t.jsx("input",{className:"peer sr-only",type:"checkbox",onChange:S,checked:l}),t.jsx("div",{className:"peer h-6 w-12 rounded-full bg-darkHover outline-none duration-100 after:absolute after:left-1 after:top-1 after:flex after:h-4 after:w-4 after:items-center after:justify-center after:rounded-full after:bg-white after:font-bold after:outline-none after:duration-500 peer-checked:after:translate-x-6 peer-checked:after:border-white peer-focus:outline-none"})]})]}),t.jsx("button",{className:"mt-auto w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",onClick:m,children:"Reset to default"})]})}function Wn(){const{users:e}=L();return t.jsx("div",{className:"flex min-h-[200px] flex-grow justify-center overflow-y-auto py-2",children:t.jsx("div",{className:"flex h-full w-full flex-wrap items-start gap-x-2 gap-y-6",children:e.map(n=>t.jsx(Yn,{user:n},n.socketId))})})}const Yn=({user:e})=>{const{username:n,status:s}=e,r=`${n} - ${s===$.ONLINE?"online":"offline"}`;return t.jsxs("div",{className:"relative flex w-[100px] flex-col items-center gap-2",title:r,children:[t.jsx(an,{name:n,size:"50",round:"12px",title:r}),t.jsx("p",{className:"line-clamp-2 max-w-full text-ellipsis break-words",children:n}),t.jsx("div",{className:`absolute right-5 top-0 h-3 w-3 rounded-full ${s===$.ONLINE?"bg-green-500":"bg-danger"}`})]})};function Jn(){const e=Q(),{viewHeight:n}=F(),{setStatus:s}=L(),{socket:r}=_(),o=async()=>{const u=window.location.href;try{await navigator.clipboard.writeText(u),R.success("URL copied to clipboard")}catch(l){R.error("Unable to copy URL to clipboard"),console.log(l)}},a=async()=>{const u=window.location.href;try{await navigator.share({url:u})}catch(l){R.error("Unable to share URL"),console.log(l)}},d=()=>{r.disconnect(),s(T.DISCONNECTED),e("/",{replace:!0})};return t.jsxs("div",{className:"flex flex-col p-4",style:{height:n},children:[t.jsx("h1",{className:"view-title",children:"Users"}),t.jsx(Wn,{}),t.jsx("div",{className:"flex flex-col items-center gap-4 pt-4",children:t.jsxs("div",{className:"flex w-full gap-4",children:[t.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:a,title:"Share Link",children:t.jsx(Ke,{size:26})}),t.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:o,title:"Copy Link",children:t.jsx(Ce,{size:22})}),t.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-primary p-3 text-black",onClick:d,title:"Leave room",children:t.jsx(Ze,{size:22})})]})})]})}var I=(e=>(e.FILES="FILES",e.CHATS="CHATS",e.CLIENTS="CLIENTS",e.RUN="RUN",e.SETTINGS="SETTINGS",e))(I||{});const Ue=i.createContext(null),X=()=>{const e=i.useContext(Ue);if(!e)throw new Error("useViews must be used within a ViewContextProvider");return e};function Vn({children:e}){const{isMobile:n}=G(),[s,r]=i.useState(I.FILES),[o,a]=i.useState(!n),[d]=i.useState({[I.FILES]:t.jsx(Pn,{}),[I.CLIENTS]:t.jsx(Jn,{}),[I.SETTINGS]:t.jsx(Gn,{}),[I.CHATS]:t.jsx(Dn,{}),[I.RUN]:t.jsx(zn,{})}),[u]=i.useState({[I.FILES]:t.jsx(et,{size:28}),[I.CLIENTS]:t.jsx(tt,{size:30}),[I.SETTINGS]:t.jsx(nt,{size:28}),[I.CHATS]:t.jsx(st,{size:30}),[I.RUN]:t.jsx(rt,{size:28})});return t.jsx(Ue.Provider,{value:{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:a,viewComponents:d,viewIcons:u},children:e})}function Bn({children:e}){const{isSidebarOpen:n}=X(),{isMobile:s,width:r}=G(),{setItem:o,getItem:a}=ve(),d=()=>{const C=document.createElement("div");return C.className="h-full cursor-e-resizer hidden md:block",C.style.backgroundColor="#e1e1ffb3",C},u=()=>{if(s)return[0,r];const C=a("editorSizes");let h=[35,65];return C&&(h=JSON.parse(C)),n?h:[0,r]},l=()=>s?[0,r]:n?[350,350]:[50,0],c=()=>s?[0,1/0]:n?[1/0,1/0]:[0,1/0],m=C=>{o("editorSizes",JSON.stringify(C))},v=()=>({width:"7px",display:n&&!s?"block":"none"});return t.jsx(un,{sizes:u(),minSize:l(),gutter:d,maxSize:c(),dragInterval:1,direction:"horizontal",gutterAlign:"center",cursor:"e-resize",snapOffset:30,gutterStyle:v,onDrag:m,className:"flex h-screen min-h-screen max-w-full items-center justify-center overflow-hidden",children:e})}function $n(){return t.jsx("div",{className:"flex h-screen min-h-screen flex-col items-center justify-center gap-6 px-4 text-center",children:t.jsx(qn,{})})}const qn=()=>{const e=Q(),n=()=>{window.location.reload()},s=()=>{e("/")};return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"whitespace-break-spaces text-lg font-medium text-slate-300",children:"Oops! Something went wrong. Please try again"}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[t.jsx("button",{className:"mr-4 rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:n,children:"Try Again"}),t.jsx("button",{className:"rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:s,children:"Go to HomePage"})]})]})},B=({viewName:e,icon:n})=>{const{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:a}=X(),{isNewMessage:d}=ee(),u=l=>{l===s?a(!o):(a(!0),r(l))};return t.jsxs("button",{onClick:()=>u(e),className:"relative flex items-center justify-center",children:[n,e===I.CHATS&&d&&t.jsx("div",{className:"absolute right-0 top-0 h-3 w-3 rounded-full bg-primary"})]})};function Qn(){const{activeView:e,isSidebarOpen:n,viewComponents:s,viewIcons:r,setIsSidebarOpen:o}=X(),{minHeightReached:a}=F(),{activityState:d,setActivityState:u}=L(),{socket:l}=_(),{isMobile:c}=G(),m=()=>{d===U.CODING?(u(U.DRAWING),l.emit(x.REQUEST_DRAWING)):u(U.CODING),c&&o(!1)};return t.jsxs("aside",{className:"flex w-full md:h-full md:max-h-full md:min-h-full md:w-auto",children:[t.jsxs("div",{className:J("fixed bottom-0 left-0 z-50 flex h-[50px] w-full gap-6 self-end overflow-auto border-t border-darkHover bg-dark p-3 md:static md:h-full md:w-[50px] md:min-w-[50px] md:flex-col md:border-r md:border-t-0 md:p-2 md:pt-4",{hidden:a}),children:[t.jsx(B,{viewName:I.FILES,icon:r[I.FILES]}),t.jsx(B,{viewName:I.CHATS,icon:r[I.CHATS]}),t.jsx(B,{viewName:I.RUN,icon:r[I.RUN]}),t.jsx(B,{viewName:I.CLIENTS,icon:r[I.CLIENTS]}),t.jsx(B,{viewName:I.SETTINGS,icon:r[I.SETTINGS]}),t.jsx("button",{className:"self-end",onClick:m,children:d===U.CODING?t.jsx(ot,{size:30}):t.jsx(it,{size:30})})]}),t.jsx("div",{className:"absolute left-0 top-0 z-20 w-full flex-grow flex-col bg-dark md:static md:w-[300px]",style:n?{}:{display:"none"},children:s[e]})]})}function Xn(){const{isMobile:e}=G();return t.jsx(dn,{inferDarkMode:!0,forceMobile:e,defaultName:"Editor",className:"z-0",children:t.jsx(Kn,{})})}function Kn(){const e=fn(),{drawingData:n,setDrawingData:s}=L(),{socket:r}=_(),o=i.useCallback(d=>{const u=d.changes;s(e.store.getSnapshot()),r.emit(x.DRAWING_UPDATE,{snapshot:u})},[e.store,s,r]),a=i.useCallback(({snapshot:d})=>{e.store.mergeRemoteChanges(()=>{const{added:u,updated:l,removed:c}=d;for(const m of Object.values(u))e.store.put([m]);for(const[,m]of Object.values(l))e.store.put([m]);for(const m of Object.values(c))e.store.remove([m.id])}),s(e.store.getSnapshot())},[e.store,s]);return i.useEffect(()=>{n&&Object.keys(n).length>0&&e.store.loadSnapshot(n)},[]),i.useEffect(()=>{const d=e.store.listen(o,{source:"user",scope:"document"});return r.on(x.DRAWING_UPDATE,a),()=>{d(),r.off(x.DRAWING_UPDATE)}},[n,e.store,o,a,r]),null}function Zn(){const{fontSize:e,setFontSize:n}=q();i.useEffect(()=>{const s=r=>{const o="Changes you made may not be saved";return r.returnValue=o};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]),i.useEffect(()=>{const s=r=>{if(r.ctrlKey){if(r.preventDefault(),!r.target.closest(".cm-editor"))return;r.deltaY>0?n(Math.max(e-1,12)):n(Math.min(e+1,24))}};return window.addEventListener("wheel",s,{passive:!1}),()=>{window.removeEventListener("wheel",s)}},[e,n])}function es(e){return hn.define({create:()=>pe(e),update(n,s){return!s.docChanged&&!s.selection?n:pe(e)},provide:n=>pn.computeN([n],s=>s.field(n))})}function pe(e){return e.map(n=>{if(!n.typing)return null;let s=n.username;const r=n.cursorPosition;return n&&(s=n.username),{pos:r,above:!0,strictSide:!0,arrow:!0,create:()=>{const o=document.createElement("div");return o.className="cm-tooltip-cursor",o.textContent=s,{dom:o}}}})}const ts=mn.baseTheme({".cm-tooltip.cm-tooltip-cursor":{backgroundColor:"#66b",color:"white",border:"none",padding:"2px 7px",borderRadius:"4px",zIndex:"10","& .cm-tooltip-arrow:before":{borderTopColor:"#66b"},"& .cm-tooltip-arrow:after":{borderTopColor:"transparent"}}});function ns(){const{users:e,currentUser:n}=L(),{activeFile:s,setActiveFile:r}=H(),{theme:o,language:a,fontSize:d}=q(),{socket:u}=_(),{viewHeight:l}=F(),[c,m]=i.useState(setTimeout(()=>{},0)),v=i.useMemo(()=>e.filter(y=>y.username!==n.username),[e,n]),[C,h]=i.useState([]),g=(y,S)=>{var z,W,Y;if(!s)return;const j={...s,content:y};r(j);const A=(Y=(W=(z=S.state)==null?void 0:z.selection)==null?void 0:W.main)==null?void 0:Y.head;u.emit(x.TYPING_START,{cursorPosition:A}),u.emit(x.FILE_UPDATED,{fileId:s.id,newContent:y}),clearTimeout(c);const O=setTimeout(()=>u.emit(x.TYPING_PAUSE),1e3);m(O)};return Zn(),i.useEffect(()=>{const y=[nn,sn,es(v),ts,xn()],S=rn(a.toLowerCase());S?y.push(S):R.error("Syntax highlighting is unavailable for this language. Please adjust the editor settings; it may be listed under a different name.",{duration:5e3}),h(y)},[v,a]),t.jsx(on,{theme:_e[o],onChange:g,value:s==null?void 0:s.content,extensions:C,minHeight:"100%",maxWidth:"100vw",style:{fontSize:d+"px",height:l,position:"relative"}})}const xe={php:"php",cs:"csharp"};function ss(){const{openFiles:e,closeFile:n,activeFile:s,updateFileContent:r,setActiveFile:o}=H(),a=i.useRef(null),{setLanguage:d}=q(),u=l=>{if((s==null?void 0:s.id)===l)return;r((s==null?void 0:s.id)||"",(s==null?void 0:s.content)||"");const c=e.find(m=>m.id===l);c&&o(c)};return i.useEffect(()=>{const l=a.current;if(!l)return;const c=m=>{m.deltaY>0?l.scrollLeft+=100:l.scrollLeft-=100};return l.addEventListener("wheel",c),()=>{l.removeEventListener("wheel",c)}},[]),i.useEffect(()=>{if((s==null?void 0:s.name)===void 0)return;const l=s.name.split(".").pop();if(!l)return;if(xe[l]){d(xe[l]);return}const c=Ne.languages(l);d(c[0])},[s==null?void 0:s.name,d]),t.jsx("div",{className:"flex h-[50px] w-full select-none gap-2 overflow-x-auto p-2 pb-0",ref:a,children:e.map(l=>t.jsxs("span",{className:J("flex w-fit cursor-pointer items-center rounded-t-md px-2 py-1 text-white",{"bg-darkHover":l.id===(s==null?void 0:s.id)}),onClick:()=>u(l.id),children:[t.jsx(Ee,{icon:Oe(l.name),fontSize:22,className:"mr-2 min-w-fit"}),t.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:l.name,children:l.name}),t.jsx(at,{className:"ml-3 inline rounded-md hover:bg-darkHover",size:20,onClick:()=>n(l.id)})]},l.id))})}function rs(){const{openFiles:e}=H(),{minHeightReached:n}=F();return e.length<=0?t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx("h1",{className:"text-xl text-white",children:"No file is currently open."})}):t.jsxs("main",{className:J("flex w-full flex-col overflow-x-auto md:h-screen",{"h-[calc(100vh-50px)]":!n,"h-full":n}),children:[t.jsx(ss,{}),t.jsx(ns,{})]})}function os(){const{viewHeight:e}=F(),{activityState:n}=L();return t.jsx("div",{className:"absolute left-0 top-0 w-full max-w-full flex-grow overflow-x-hidden md:static",style:{height:e},children:n===U.DRAWING?t.jsx(Xn,{}):t.jsx(rs,{})})}function is(){function e(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(r=>navigator.userAgent.match(r))}const n=e();i.useEffect(()=>{n&&fe.isEnabled&&fe.request()},[n])}function as(){const{setUsers:e}=L(),{socket:n}=_(),s=i.useCallback(()=>{document.visibilityState==="visible"?n.emit(x.USER_ONLINE,{socketId:n.id}):document.visibilityState==="hidden"&&n.emit(x.USER_OFFLINE,{socketId:n.id})},[n]),r=i.useCallback(({socketId:d})=>{e(u=>u.map(l=>l.socketId===d?{...l,status:$.ONLINE}:l))},[e]),o=i.useCallback(({socketId:d})=>{e(u=>u.map(l=>l.socketId===d?{...l,status:$.OFFLINE}:l))},[e]),a=i.useCallback(({user:d})=>{e(u=>u.map(l=>l.socketId===d.socketId?d:l))},[e]);i.useEffect(()=>(document.addEventListener("visibilitychange",s),n.on(x.USER_ONLINE,r),n.on(x.USER_OFFLINE,o),n.on(x.TYPING_START,a),n.on(x.TYPING_PAUSE,a),()=>{document.removeEventListener("visibilitychange",s),n.off(x.USER_ONLINE),n.off(x.USER_OFFLINE),n.off(x.TYPING_START),n.off(x.TYPING_PAUSE)}),[n,e,s,r,o,a])}function ls(){var u;as(),is();const e=Q(),{roomId:n}=ln(),{status:s,setCurrentUser:r,currentUser:o}=L(),{socket:a}=_(),d=ye();return i.useEffect(()=>{var c;if(o.username.length>0)return;const l=(c=d.state)==null?void 0:c.username;if(l===void 0)e("/",{state:{roomId:n}});else if(n){const m={username:l,roomId:n};r(m),a.emit(x.JOIN_REQUEST,m)}},[o.username,(u=d.state)==null?void 0:u.username,e,n,r,a]),s===T.CONNECTION_FAILED?t.jsx($n,{}):t.jsxs(Bn,{children:[t.jsx(Qn,{}),t.jsx(os,{})]})}const cs="/assets/illustration-D75szsYn.svg",us="/assets/logo-CQCuwBZv.svg",ds=()=>{var C,h;const e=ye(),{currentUser:n,setCurrentUser:s,status:r,setStatus:o}=L(),{socket:a}=_(),d=i.useRef(null),u=Q(),l=()=>{var g;s({...n,roomId:M()}),k.success("Created a new Room Id"),(g=d.current)==null||g.focus()},c=g=>{const y=g.target.name,S=g.target.value;s({...n,[y]:S})},m=()=>n.username.length===0?(k.error("Enter your username"),!1):n.roomId.length===0?(k.error("Enter a room id"),!1):n.roomId.length<5?(k.error("ROOM Id must be at least 5 characters long"),!1):n.username.length<3?(k.error("Username must be at least 3 characters long"),!1):!0,v=g=>{g.preventDefault(),r!==T.ATTEMPTING_JOIN&&m()&&(k.loading("Joining room..."),o(T.ATTEMPTING_JOIN),a.emit(x.JOIN_REQUEST,n))};return i.useEffect(()=>{var g;n.roomId.length>0||(g=e.state)!=null&&g.roomId&&(s({...n,roomId:e.state.roomId}),n.username.length===0&&k.success("Enter your username"))},[n,(C=e.state)==null?void 0:C.roomId,s]),i.useEffect(()=>{if(r===T.DISCONNECTED&&!a.connected){a.connect();return}const g=sessionStorage.getItem("redirect")||!1;if(r===T.JOINED&&!g){const y=n.username;sessionStorage.setItem("redirect","true"),u(`/editor/${n.roomId}`,{state:{username:y}})}else r===T.JOINED&&g&&(sessionStorage.removeItem("redirect"),o(T.DISCONNECTED),a.disconnect(),a.connect())},[n,(h=e.state)==null?void 0:h.redirect,u,o,a,r]),t.jsxs("div",{className:"flex w-full max-w-[500px] flex-col items-center justify-center gap-4 p-4 sm:w-[500px] sm:p-8",children:[t.jsx("img",{src:us,alt:"Logo",className:"w-full"}),t.jsxs("form",{onSubmit:v,className:"flex w-full flex-col gap-4",children:[t.jsx("input",{type:"text",name:"roomId",placeholder:"Room Id",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:c,value:n.roomId}),t.jsx("input",{type:"text",name:"username",placeholder:"Username",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:c,value:n.username,ref:d}),t.jsx("button",{type:"submit",className:"mt-2 w-full rounded-md bg-primary px-8 py-3 text-lg font-semibold text-black",children:"Join"})]}),t.jsx("button",{className:"cursor-pointer select-none underline",onClick:l,children:"Generate Unique Room Id"})]})};function fs(){return t.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center gap-16",children:t.jsxs("div",{className:"my-12 flex h-full min-w-full flex-col items-center justify-evenly sm:flex-row sm:pt-0",children:[t.jsx("div",{className:"flex w-full animate-up-down justify-center sm:w-1/2 sm:pl-4",children:t.jsx("img",{src:cs,alt:"Code Sync Illustration",className:"mx-auto w-[250px] sm:w-[400px]"})}),t.jsx("div",{className:"flex w-full items-center justify-center sm:w-1/2",children:t.jsx(ds,{})})]})})}const ms=()=>t.jsxs(t.Fragment,{children:[t.jsx(Me,{children:t.jsxs(cn,{children:[t.jsx(de,{path:"/",element:t.jsx(fs,{})}),t.jsx(de,{path:"/editor/:roomId",element:t.jsx(ls,{})})]})}),t.jsx(bn,{})," ",t.jsx(wn,{})]});function hs({children:e}){return t.jsx(Cn,{children:t.jsx(Nn,{children:t.jsx(gn,{children:t.jsx(Vn,{children:t.jsx(Ln,{children:t.jsx(Hn,{children:t.jsx(yn,{children:e})})})})})})})}ze.createRoot(document.getElementById("root")).render(t.jsx(hs,{children:t.jsx(ms,{})}));
